
# Telegram Profile Parser - Руководство по развертыванию на Webhost1.ru

Это исчерпывающее руководство поможет вам шаг за шагом развернуть и запустить бота (бэкенд) и админ-панель (фронтенд) на облачном VDS-сервере от Webhost1.ru с операционной системой Ubuntu.

## Часть 1: Подготовка сервера на Webhost1.ru

1.  **Заказ сервера:**
    *   Зайдите в панель управления Webhost1.ru.
    *   Создайте новый VDS-сервер (раздел "Виртуальные серверы").
    *   При заказе выберите операционную систему **Ubuntu 22.04 LTS**. Это самая стабильная и рекомендуемая версия.
    *   Выберите тариф. Для старта хватит самого простого (например, VDS-Промо).
    *   После заказа дождитесь письма на почту с данными для доступа.
2.  **Подключение к серверу:**
    *   В письме от Webhost1.ru вы найдете IP-адрес, логин (`root`) и пароль.
    *   Откройте терминал на вашем компьютере (если у вас Windows, можете использовать PowerShell, CMD или [PuTTY](https://www.putty.org/)).
    *   Подключитесь к серверу по SSH командой:
        ```bash
        ssh root@ВАШ_IP_АДРЕС_СЕРВЕРА
        ```
    *   Система попросит подтвердить подлинность хоста (введите `yes`) и затем введите пароль, который вам прислали.

## Часть 2: Установка необходимого ПО

Эти команды нужно выполнять в терминале, подключившись к вашему серверу.

1.  **Обновление системы:**
    ```bash
    apt update && apt upgrade -y
    ```
2.  **Установка Node.js (через nvm - менеджер версий):**
    ```bash
    # Скачиваем и запускаем скрипт установки nvm
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
    # Активируем nvm (нужно для текущей сессии)
    export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
    # Устанавливаем стабильную версию Node.js (например, v20)
    nvm install 20
    # Делаем эту версию основной
    nvm use 20
    ```
3.  **Установка базы данных PostgreSQL:**
    ```bash
    apt install postgresql postgresql-contrib -y
    ```
4.  **Установка PM2 (менеджер процессов для Node.js):**
    PM2 нужен, чтобы ваш бот работал 24/7 и автоматически перезапускался в случае сбоев или перезагрузки сервера.
    ```bash
    npm install pm2 -g
    ```
5.  **Установка Git (для загрузки кода):**
    ```bash
    apt install git -y
    ```
## Часть 3: Настройка базы данных PostgreSQL

1.  **Войдите в режим управления PostgreSQL:**
    ```bash
    sudo -u postgres psql
    ```
2.  **Создайте пользователя для бота.** Придумайте надежный пароль вместо `my_secure_password`.
    ```sql
    CREATE USER bot_user WITH PASSWORD 'my_secure_password';
    ```
3.  **Создайте базу данных для бота:**
    ```sql
    CREATE DATABASE bot_db;
    ```
4.  **Дайте все права новому пользователю на новую базу данных:**
    ```sql
    GRANT ALL PRIVILEGES ON DATABASE bot_db TO bot_user;
    ```
5.  **Выйдите из psql:**
    ```sql
    \q
    ```
6.  **Сформируйте строку подключения (DATABASE_URL):** Она понадобится нам на следующем шаге. Формат: `postgres://USER:PASSWORD@HOST:PORT/DATABASE`. Для нашей настройки она будет выглядеть так:
    `postgres://bot_user:my_secure_password@localhost:5432/bot_db`

## Часть 4: Развертывание и запуск бэкенда (бот + API)

1.  **Загрузите код на сервер.** Проще всего это сделать, если ваш код лежит на GitHub.
    ```bash
    # Перейдите в домашнюю директорию
    cd ~
    # Клонируйте ваш репозиторий (замените URL на свой)
    git clone https://github.com/ваш_логин/ваш_репозиторий.git
    # Перейдите в папку с проектом, а затем в папку бэкенда
    cd ваш_репозиторий/backend
    ```
2.  **Установите зависимости проекта:**
    ```bash
    npm install
    ```
3.  **Настройте переменные окружения:**
    *   Создайте файл `.env`, скопировав пример:
        ```bash
        cp .env.example .env
        ```
    *   Откройте файл для редактирования (например, с помощью `nano`):
        ```bash
        nano .env
        ```
    *   **Заполните все поля вашими данными:**
        *   `TELEGRAM_BOT_TOKEN`: Токен вашего бота от `@BotFather`.
        *   `API_KEY`: Ваш ключ для Google Gemini API.
        *   `DATABASE_URL`: Строка подключения к БД, которую мы сформировали на предыдущем шаге.
        *   `PORT`: Можно оставить `3001`.
    *   Сохраните файл и выйдите из `nano` (нажмите `Ctrl+X`, затем `Y`, затем `Enter`).

4.  **Соберите (скомпилируйте) проект:**
    ```bash
    npm run build
    ```
5.  **Запустите бота с помощью PM2:**
    ```bash
    pm2 start npm --name "telegram-bot" -- start
    ```
6.  **Проверьте статус:**
    *   Убедитесь, что бот запустился и работает (`status` должен быть `online`):
        ```bash
        pm2 list
        ```
    *   Посмотрите логи, чтобы убедиться, что нет ошибок:
        ```bash
        pm2 logs telegram-bot
        ```
7.  **Настройте автозапуск PM2:** Эта команда сгенерирует и покажет вам команду, которую нужно выполнить, чтобы ваши приложения запускались автоматически после перезагрузки сервера. Просто скопируйте и выполните ее.
    ```bash
    pm2 startup
    ```
    ```bash
    pm2 save
    ```

**Бэкенд запущен и работает!** Теперь можно перейти к админ-панели.

## Часть 5: Развертывание админ-панели (фронтенд)

Мы разместим админ-панель на том же сервере, используя веб-сервер Nginx, который очень прост в настройке.

1.  **Установите Nginx:**
    ```bash
    apt install nginx -y
    ```
2.  **Создайте папку для файлов админ-панели:**
    ```bash
    mkdir -p /var/www/admin-panel
    ```
3.  **Загрузите файлы фронтенда:** Скопируйте все файлы вашей админ-панели (`index.html`, `App.tsx`, `components/`, `types.ts` и т.д.) в папку `/var/www/admin-panel` на сервере. Это можно сделать через `scp` или FileZilla.
4.  **Отредактируйте `App.tsx` на сервере:**
    *   Откройте файл: `nano /var/www/admin-panel/App.tsx`
    *   Найдите строку: `const API_URL = 'http://localhost:3001/api';`
    *   **Замените `localhost` на IP-адрес вашего сервера**:
        `const API_URL = 'http://ВАШ_IP_АДРЕС_СЕРВЕРА:3001/api';`
    *   Сохраните и закройте файл.
5.  **Настройте Nginx для админ-панели:**
    *   Создайте новый файл конфигурации:
        ```bash
        nano /etc/nginx/sites-available/admin-panel
        ```
    *   Вставьте в него следующий текст, заменив `ВАШ_IP_АДРЕС_СЕРВЕРА` на реальный IP:
        ```nginx
        server {
            listen 80;
            server_name ВАШ_IP_АДРЕС_СЕРВЕРА;

            root /var/www/admin-panel;
            index index.html;

            location / {
                try_files $uri $uri/ =404;
            }
        }
        ```
    *   Активируйте эту конфигурацию, создав символическую ссылку:
        ```bash
        ln -s /etc/nginx/sites-available/admin-panel /etc/nginx/sites-enabled/
        ```
    *   Проверьте конфигурацию на ошибки:
        ```bash
        nginx -t
        ```
    *   Если ошибок нет (`syntax is ok`, `test is successful`), перезапустите Nginx:
        ```bash
        systemctl restart nginx
        ```
6.  **Настройте брандмауэр (Firewall):**
    ```bash
    ufw allow 'Nginx Full' # Открывает порты 80 и 443
    ufw allow 3001/tcp     # Открывает порт для нашего API
    ufw allow ssh          # Обязательно разрешаем SSH, чтобы не потерять доступ
    ufw enable             # Включает брандмауэр (нажмите 'y' для подтверждения)
    ```

### Готово!

Теперь вы можете:
*   **Написать вашему боту в Telegram.** Он обработает анкету и сохранит её в базу данных.
*   **Открыть админ-панель в браузере**, перейдя по адресу `http://ВАШ_IP_АДРЕС_СЕРВЕРА`. Вы должны увидеть все собранные анкеты.

Вы создали полностью рабочую, автономную систему на вашем сервере!